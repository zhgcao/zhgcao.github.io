<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="没有什么能够阻挡，你对自由的向往！">
<meta property="og:type" content="website">
<meta property="og:title" content="匿名">
<meta property="og:url" content="https://zhgcao.github.io/index.html">
<meta property="og:site_name" content="匿名">
<meta property="og:description" content="没有什么能够阻挡，你对自由的向往！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="匿名">
<meta name="twitter:description" content="没有什么能够阻挡，你对自由的向往！">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://zhgcao.github.io/"/>

  <title> 匿名 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">匿名</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">爱自由、爱爬墙</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/06/ubuntu-install-gateone/" itemprop="url">
                  Ubuntu 安装配置 GateOne
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-06T19:03:29+08:00" content="2016-09-06">
              2016-09-06
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>平常要操作VPS，大多是用putty这样的SSH客户端连接，但某些情况，不能直接通过SSH连接，putty就无法使用了。<br>最近试用了一下GateOne，这是一个Web方式的SSH，安装设置好后，就可以通过Web页面来访问VPS了，试用下来，还是挺好用的。</p>
<p>GateOne是开源的，在GitHub上的地址：<a href="https://github.com/liftoff/GateOne" target="_blank" rel="external">https://github.com/liftoff/GateOne</a><br>官方的介绍：<a href="http://liftoff.github.io/GateOne/" target="_blank" rel="external">http://liftoff.github.io/GateOne/</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>GateOne是用Python基于tornado框架开发的，要安装GateOne，需要先安装python、pip、tornado。<br>python、pip的安装略过，tornado可以用如下命令安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip install tornado</span></span><br></pre></td></tr></table></figure></p>
<p>找一个目录，从GitHub下载GateOne的代码并安装（需要root权限）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git clone git://github.com/liftoff/GateOne</span></span><br><span class="line"><span class="comment"># cd GateOne/</span></span><br><span class="line"><span class="comment"># python setup.py install</span></span><br></pre></td></tr></table></figure></p>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>安装完成后，直接执行如下命令就能启动GateOne（如果有Nginx、Apache等web服务器占用了443端口，需要先停止）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gateone</span></span><br></pre></td></tr></table></figure></p>
<p>如果要以后台方式启动，可以用如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service gateone start</span></span><br></pre></td></tr></table></figure></p>
<p>执行后，在浏览器输入<code>https://&lt;VPS IP&gt;</code> 就能使用了。</p>
<h2 id="配合Nginx的设置"><a href="#配合Nginx的设置" class="headerlink" title="配合Nginx的设置"></a>配合Nginx的设置</h2><p>虽然GateOne并不需要设置就能用，但其自带的SSL证书是无效的，访问时会提示网站不可信，同时，可能也不希望其独占443端口，这时可以配合Nginx来使用。</p>
<p>先修改GateOne的配置文件：<code>/etc/gateone/conf.d/10server.conf</code><br>找到以下几项内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;address&quot;: &quot;127.0.0.1&quot;,		</span><br><span class="line">&quot;disable_ssl&quot;: true,</span><br><span class="line">&quot;port&quot;: 54321,</span><br><span class="line">&quot;url_prefix&quot;: &quot;/gateone/&quot;,</span><br></pre></td></tr></table></figure></p>
<p>address改为”127.0.0.1”，这样外网不能直接访问GateOne，只能通过Nginx转发<br>disable_ssl设为True，表示不用GateOne自带的证书<br>port改为一个未占用的端口，要和Nginx设置一致<br>url_prefix改为”/gateone/“，要和Nginx设置一致</p>
<p>修改Nginx的设置文件，如<code>/etc/nginx/sites-enabled/default</code>，设置示例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  &lt;domain&gt;;</span><br><span class="line">	</span><br><span class="line">	ssl on;</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/&lt;domain&gt;/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/&lt;domain&gt;/privkey.pem;	</span><br><span class="line"></span><br><span class="line">    # GateOne</span><br><span class="line">    location /gateone/ &#123;</span><br><span class="line">        proxy_pass       http://127.0.0.1:54321;</span><br><span class="line"></span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_pass_header Server;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">        proxy_set_header X-Real-IP $http_address;</span><br><span class="line">        proxy_set_header X-Scheme $scheme;</span><br><span class="line"></span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>其中的location和proxy_pass中的端口，要和GateOne中的设置一致。</p>
<p>设置好后，重启Nginx和GateOne，然后在浏览器输入<code>https://&lt;Domain&gt;/gateone/</code> 就能使用了。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>GateOne用起来很方便，基本试试就会了，功能也比较强大，一个页面还可以最多开4个窗口，另外，还支持直接查看图片、pdf等文件，这点比putty还方便。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/07/ubuntu-install-letsencrypt/" itemprop="url">
                  Ubuntu 安装 Let's Encrypt 获取免费证书
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-07T12:41:11+08:00" content="2016-07-07">
              2016-07-07
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以前给自己的网站申请免费证书，要去<a href="https://www.startssl.com/" target="_blank" rel="external">StartSSL</a>这里申请，申请的步骤相对比较繁琐，证书到期前还要记得到网站去更新。</p>
<p>最近发现了一个开源的工具：Certbot（原来的名字叫Let’s Encrypt），安装以后申请证书相当的方便，证书到期前还能用定时任务自动更新，申请到的证书也能被各大主流浏览器接受。<br>Certbot的介绍：<a href="https://letsencrypt.org/" target="_blank" rel="external">https://letsencrypt.org/</a><br>在GitHub上的开源项目地址：<a href="https://github.com/certbot/certbot" target="_blank" rel="external">https://github.com/certbot/certbot</a></p>
<p>下面以Ubuntu 16.04为例，简要介绍如何安装和使用这个工具。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>在 Ubuntu 16.04 下，安装非常的容易，执行以下一条命令即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get install letsencrypt</span></span><br></pre></td></tr></table></figure></p>
<h2 id="获取证书"><a href="#获取证书" class="headerlink" title="获取证书"></a>获取证书</h2><p>首先要有至少一个域名并指向安装工具的服务器，Certbot在获取证书时会使用80端口来验证域名，所以要先停止Apache、Nginx等web服务器，然后执行以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># letsencrypt certonly</span></span><br></pre></td></tr></table></figure></p>
<p>然后会出现一个交互的窗口，总共3步：<br>首先输入一个email地址，用于接收紧急通知和恢复。<br>第二步选择同意他们的服务条款。<br>第三步输入要申请的域名，如果有多个域名可以一起申请，多个域名以逗号或空格分开，目前还不支持通配的域名证书。</p>
<p>顺利的话，会看到以下信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - If you lose your account credentials, you can recover through</span><br><span class="line">   e-mails sent to &lt;email address&gt;.</span><br><span class="line"> - Congratulations! Your certificate and chain have been saved at</span><br><span class="line">   /etc/letsencrypt/live/&lt;domain&gt;/fullchain.pem. Your cert will expire</span><br><span class="line">   on 2016-10-05. To obtain a new version of the certificate in the</span><br><span class="line">   future, simply run Let&apos;s Encrypt again.</span><br><span class="line"> - Your account credentials have been saved in your Let&apos;s Encrypt</span><br><span class="line">   configuration directory at /etc/letsencrypt. You should make a</span><br><span class="line">   secure backup of this folder now. This configuration directory will</span><br><span class="line">   also contain certificates and private keys obtained by Let&apos;s</span><br><span class="line">   Encrypt so making regular backups of this folder is ideal.</span><br><span class="line"> - If you like Let&apos;s Encrypt, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">   Donating to ISRG / Let&apos;s Encrypt:   https://letsencrypt.org/donate</span><br><span class="line">   Donating to EFF:                    https://eff.org/donate-le</span><br></pre></td></tr></table></figure></p>
<p>这样就表示申请成功了，申请的域名保存在<code>/etc/letsencrypt/live/&lt;domain&gt;</code>目录下（<code>&lt;domain&gt;</code>是申请时输入的第一个域名），目录下有4个文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /etc/letsencrypt/live/&lt;domain&gt;/</span></span><br><span class="line">cert.pem  chain.pem  fullchain.pem  privkey.pem</span><br></pre></td></tr></table></figure></p>
<p>其中<code>fullchain.pem</code>为证书文件，<code>privkey.pem</code>为证书的私钥。</p>
<h2 id="使用申请的证书"><a href="#使用申请的证书" class="headerlink" title="使用申请的证书"></a>使用申请的证书</h2><p>以Nginx为例，把证书配置到Nginx的配置文件即可，如以下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  &lt;domain&gt;;</span><br><span class="line">    </span><br><span class="line">    # SSL证书的设置</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/&lt;domain&gt;/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/&lt;domain&gt;/privkey.pem;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置后，重启Nginx，然后就可以通过<code>https://&lt;domain&gt;</code>来访问了。</p>
<h2 id="更新证书"><a href="#更新证书" class="headerlink" title="更新证书"></a>更新证书</h2><p>Certbot申请的证书，有效期只有90天，到期前需要更新证书，可以用如下命令来测试一下更新证书，更新前，也需要先暂停Nginx，更新成功后，再重启Nginx：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># letsencrypt renew --dry-run --agree-tos</span></span><br></pre></td></tr></table></figure></p>
<p>其中<code>--dry-run</code>表示这是一个测试，并不真正更新，如果成功则表示可以更新证书，正式更新时把这个选项去掉即可。</p>
<p>看到如下信息就表示更新成功了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Congratulations, all renewals succeeded. The following certs have been renewed:</span><br><span class="line">  /etc/letsencrypt/live/&lt;domain&gt;/fullchain.pem (success)</span><br></pre></td></tr></table></figure></p>
<h2 id="自动更新证书"><a href="#自动更新证书" class="headerlink" title="自动更新证书"></a>自动更新证书</h2><p>可以写一个脚本，将停止Nginx、更新证书、重启Nginx这三步写入脚本，由系统定时自动调用，实现证书的自动更新。</p>
<p>比如在<code>/usr/bin/</code>创建一个脚本<code>cb-renew.sh</code>，脚本内容可以参考如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">systemctl stop nginx</span><br><span class="line">letsencrypt renew --agree-tos</span><br><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure></p>
<p>保存后，设置脚本为可执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chmod +x /usr/bin/cb-renew.sh</span></span><br></pre></td></tr></table></figure></p>
<p>在<code>/etc/crontab</code>文件最后增加一行，如下表示每2个月1号的2点30分，以root用户自动执行更新脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 2 1 */2 * root /usr/bin/cb-renew.sh</span><br></pre></td></tr></table></figure></p>
<p>重启系统cron进程：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart cron</span></span><br></pre></td></tr></table></figure></p>
<h2 id="其他Linux和Webserver的安装使用方法"><a href="#其他Linux和Webserver的安装使用方法" class="headerlink" title="其他Linux和Webserver的安装使用方法"></a>其他Linux和Webserver的安装使用方法</h2><p>Certbot目前还是Beta版本，不同的Linux版本，安装使用方法不太一样，其他情况可以访问：<a href="https://certbot.eff.org/" target="_blank" rel="external">https://certbot.eff.org/</a>，选择自己的Webserver和操作系统来了解安装使用方法。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/03/201606-cost-effective-vps/" itemprop="url">
                  性价比较高的VPS（201606）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-03T09:32:14+08:00" content="2016-07-03">
              2016-07-03
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原来用的VPS是在搬瓦工特价时申请的，只有128m内存，4G硬盘，虽然用来爬墙是足够了，但如果要折腾点别的，就觉得还是小了点，所以一直想着再申请个大一点的。正好最近也有两个朋友问我关于VPS的事，就去了解了一下。</p>
<h2 id="搬瓦工-BandwagonHost"><a href="#搬瓦工-BandwagonHost" class="headerlink" title="搬瓦工 (BandwagonHost)"></a>搬瓦工 (BandwagonHost)</h2><p><a href="https://bandwagonhost.com/" title="Link to BandwagonHost" target="_blank" rel="external">搬瓦工</a> 是我申请第一个VPS的地方，当时特价的时候很便宜，我的128m内存的，一年只需要6刀，而且一直很稳定，没出过啥问题。不过现在特价的没有了，最便宜的要20刀一年，而且这个20刀的只有256m内存，要知道当年特价的时候，512m的也只要10刀。</p>
<p>虽然价钱贵了，不过搬瓦工仍然是值得推荐的，一是他的服务一直比较稳定，算是一个比较老牌可靠的VPS提供商，二是他们的管理面板上可以一键安装Shadowsocks，对于国内买VPS用来爬墙的算是个很贴心的服务。</p>
<p>目前两款比较低配的OpenVZ的VPS参数如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">10G VPS</th>
<th style="text-align:left">20G VPS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">价格: $19.99/年</td>
<td style="text-align:left">价格: $49.99/年</td>
</tr>
<tr>
<td style="text-align:left">硬盘: 10 GB SSD</td>
<td style="text-align:left">硬盘: 20 GB SSD</td>
</tr>
<tr>
<td style="text-align:left">内存: 256 MB</td>
<td style="text-align:left">内存: 512 MB </td>
</tr>
<tr>
<td style="text-align:left">CPU: 1x Intel Xeon</td>
<td style="text-align:left">CPU: 2x Intel Xeon</td>
</tr>
<tr>
<td style="text-align:left">带宽: 500 GB/月</td>
<td style="text-align:left">带宽: 1 TB/月 </td>
</tr>
<tr>
<td style="text-align:left"><a href="https://bandwagonhost.com/aff.php?aff=1322&amp;pid=12" target="_blank" rel="external">购买链接</a></td>
<td style="text-align:left"><a href="https://bandwagonhost.com/aff.php?aff=1322&amp;pid=13" target="_blank" rel="external">购买链接</a></td>
</tr>
</tbody>
</table>
<p>点击购买链接后，默认是月付的，要年付，需要在 Billing Cycle 中改为 “$x9.99 USD Annually”。<br>搬瓦工现在有5个机房可选，美国的洛杉矶、费利蒙、凤凰城、佛罗里达和荷兰的阿姆斯特丹，购买后也可以在5个机房之间随意转移VPS，还支持支付宝付款。</p>
<h2 id="HostUs"><a href="#HostUs" class="headerlink" title="HostUs"></a>HostUs</h2><p><a href="https://hostus.us/" title="Link to HostUs" target="_blank" rel="external">HostUs</a> 据说也是一个开了挺多年的VPS提供商，低价的VPS内存和流量都挺大的，而且在亚洲的香港和新加坡也有机房。</p>
<p>在HostUs购买VPS需要注意一点：注册时的IP、填的地址和电话，都要一致，如果翻墙注册时填国内的地址电话，很容易被认为是欺诈而取消掉。</p>
<p>个人觉得以下几个OpenVZ架构的VPS性价比不错：</p>
<table>
<thead>
<tr>
<th style="text-align:left">768MB</th>
<th style="text-align:left">2 GB</th>
<th style="text-align:left">亚太 256MB</th>
<th style="text-align:left">亚太 512MB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">价格: $15/年</td>
<td style="text-align:left">价格: $35/年</td>
<td style="text-align:left">价格: $25/年</td>
<td style="text-align:left">价格: $35/年</td>
</tr>
<tr>
<td style="text-align:left">内存: 768 MB</td>
<td style="text-align:left">内存: 2 GB</td>
<td style="text-align:left">内存: 256 MB</td>
<td style="text-align:left">内存: 512 MB</td>
</tr>
<tr>
<td style="text-align:left">vSwap: 768 MB</td>
<td style="text-align:left">vSwap: 2 GB</td>
<td style="text-align:left">vSwap: 256 MB</td>
<td style="text-align:left">vSwap: 512 MB</td>
</tr>
<tr>
<td style="text-align:left">硬盘: 20 GB</td>
<td style="text-align:left">硬盘: 75 GB</td>
<td style="text-align:left">硬盘: 10 GB SSD</td>
<td style="text-align:left">硬盘: 15 GB SSD</td>
</tr>
<tr>
<td style="text-align:left">CPU: 1x</td>
<td style="text-align:left">CPU: 4x</td>
<td style="text-align:left">CPU: 1x</td>
<td style="text-align:left">CPU: 1x</td>
</tr>
<tr>
<td style="text-align:left">带宽: 2 TB/月</td>
<td style="text-align:left">带宽: 2 TB/月</td>
<td style="text-align:left">带宽: 500 GB/月</td>
<td style="text-align:left">带宽: 750 GB/月</td>
</tr>
<tr>
<td style="text-align:left">机房：美国洛杉矶、亚特兰大、达拉斯、华盛顿和英国伦敦</td>
<td style="text-align:left">机房：美国洛杉矶、亚特兰大、达拉斯、华盛顿和英国伦敦</td>
<td style="text-align:left">机房：香港、新加坡</td>
<td style="text-align:left">机房：香港、新加坡</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://my.hostus.us/aff.php?aff=1361&amp;pid=103" target="_blank" rel="external">购买链接</a></td>
<td style="text-align:left"><a href="https://my.hostus.us/aff.php?aff=1361&amp;pid=142" target="_blank" rel="external">购买链接</a></td>
<td style="text-align:left"><a href="https://my.hostus.us/aff.php?aff=1361&amp;pid=183" target="_blank" rel="external">购买链接</a></td>
<td style="text-align:left"><a href="https://my.hostus.us/aff.php?aff=1361&amp;pid=179" target="_blank" rel="external">购买链接</a></td>
<td></td>
</tr>
</tbody>
</table>
<p>上面的几个都是OpenVZ架构的，如果需要KVM架构的，可以考虑下面两个：</p>
<table>
<thead>
<tr>
<th style="text-align:left">KVM-0.5</th>
<th style="text-align:left">KVM-1</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">价格: $4.35/月</td>
<td style="text-align:left">价格: $7.95/月</td>
</tr>
<tr>
<td style="text-align:left">内存: 512 MB</td>
<td style="text-align:left">内存: 1 GB </td>
</tr>
<tr>
<td style="text-align:left">硬盘: 15 GB SSD</td>
<td style="text-align:left">硬盘: 30 GB SSD</td>
</tr>
<tr>
<td style="text-align:left">带宽: 750 GB/月</td>
<td style="text-align:left">带宽: 1 TB/月 </td>
</tr>
<tr>
<td style="text-align:left">机房：美国洛杉矶、亚特兰大、华盛顿</td>
<td style="text-align:left">机房：美国洛杉矶、亚特兰大、华盛顿</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://my.hostus.us/aff.php?aff=1361&amp;pid=307" target="_blank" rel="external">购买链接</a></td>
<td style="text-align:left"><a href="https://my.hostus.us/aff.php?aff=1361&amp;pid=308" target="_blank" rel="external">购买链接</a></td>
</tr>
</tbody>
</table>
<h2 id="Hostodo"><a href="#Hostodo" class="headerlink" title="Hostodo"></a>Hostodo</h2><p><a href="https://hostodo.com/" target="_blank" rel="external">Hostodo</a> 据说是一家2014年才开的VPS提供商，用的人似乎还不多，低价的VPS硬盘和流量比较大，似乎用来做个人网盘挺好的，不过因为开的时间还不够长，稳定性未知，如果做网盘建议做好备份。</p>
<p>个人觉得以下几个OpenVZ的VPS性价比不错：</p>
<table>
<thead>
<tr>
<th style="text-align:left">VZ-256</th>
<th style="text-align:left">VZ-512</th>
<th style="text-align:left">VZ-1000</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">价格: $10/年</td>
<td style="text-align:left">价格: $12/年</td>
<td style="text-align:left">价格: $18/年</td>
</tr>
<tr>
<td style="text-align:left">内存: 256 MB</td>
<td style="text-align:left">内存: 512 MB</td>
<td style="text-align:left">内存: 1 GB</td>
</tr>
<tr>
<td style="text-align:left">vSwap: 256 MB</td>
<td style="text-align:left">vSwap: 512 MB</td>
<td style="text-align:left">vSwap: 1 GB</td>
</tr>
<tr>
<td style="text-align:left">硬盘: 40 GB</td>
<td style="text-align:left">硬盘: 55 GB</td>
<td style="text-align:left">硬盘: 90 GB</td>
</tr>
<tr>
<td style="text-align:left">带宽: 1 TB/月</td>
<td style="text-align:left">带宽: 2 TB/月</td>
<td style="text-align:left">带宽: 3 TB/月</td>
</tr>
<tr>
<td style="text-align:left">优惠码: 无</td>
<td style="text-align:left">优惠码: LETYRLYSPECIAL512M</td>
<td style="text-align:left">优惠码: LowEnd1G</td>
</tr>
<tr>
<td style="text-align:left">购买链接：<br><a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=12" target="_blank" rel="external">洛杉矶</a>，<a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=42" target="_blank" rel="external">迈阿密</a>，<a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=89" target="_blank" rel="external">达拉斯</a></td>
<td style="text-align:left">购买链接：<br><a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=13" target="_blank" rel="external">洛杉矶</a>，<a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=43" target="_blank" rel="external">迈阿密</a>，<a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=90" target="_blank" rel="external">达拉斯</a></td>
<td style="text-align:left">购买链接：<br><a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=14" target="_blank" rel="external">洛杉矶</a>，<a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=44" target="_blank" rel="external">迈阿密</a>，<a href="http://hostodo.com/portal/aff.php?aff=162&amp;pid=91" target="_blank" rel="external">达拉斯</a> </td>
</tr>
</tbody>
</table>
<p>注意VZ-512和VZ-1000都要优惠码，直接点链接默认是月付的，在 Billing Cycle 选择年付后默认的价格分别是$25/年和$45/年，要点击Continue后，找到“Have a promotion code? Click here to add it”，点击输入上面的优惠码才会变成$12/年和$18/年。</p>
<p>Hostodo还有个卖点，就是号称可以提供亚洲优化IP，见<a href="http://hostodo.com/portal/announcements/13/Asia-Optimized-IPs-Available.html" target="_blank" rel="external">官方公告</a>，如果有需求，可以发Ticket或邮件给他们申请。不过用网上看到的测试IP来测试Ping值，速度的提升有限，比原IP稍好一点，不能和香港、日本等亚洲机房比。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/25/set-http-to-remote-git/" itemprop="url">
                  通过http(s)协议访问自建的Git远程仓库
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-25T12:35:51+08:00" content="2016-06-25">
              2016-06-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>上一篇<a href="/2016/06/14/git-create-remote-server/">Git自建远程仓库</a>，里面创建的远程库，是通过SSH协议来连接的，除了SSH协议，Git还支持通过http(s)协议或Git协议来访问远程库，配置也不太复杂。</p>
<h2 id="Http协议"><a href="#Http协议" class="headerlink" title="Http协议"></a>Http协议</h2><p>以Ubuntu为例，可以通过Nginx来配置http(s)访问Git远程库，系统需要先安装了Nginx，如果没有安装，可以用以下命令安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get install nginx</span></span><br></pre></td></tr></table></figure></p>
<p>假设仓库放在/home/git目录下，在此目录下创建一个新的裸仓库，库名称为sample.git：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git init --bare sample.git</span></span><br></pre></td></tr></table></figure></p>
<p>修改新建的库的权限，让所有人均可修改，因为通过http访问时，默认用户是<code>www-data</code>，不改权限会不能push。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chmod -R a+w sample.git</span></span><br></pre></td></tr></table></figure></p>
<p>可以让Nginx来管理访问时的用户鉴权，用以下命令增加一个git用户并按提示设置密码，可以创建多个用户。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># htpasswd [-c] /etc/nginx/passwd git</span></span><br></pre></td></tr></table></figure></p>
<p>如果提示没有<code>htpasswd</code>命令，需要先安装apache2-utils包：<code>apt-get install apache2-utils</code>。<br><code>/etc/nginx/passwd</code>为用户名和密码文件，<code>-c</code> 参数表示创建一个新的密码文件，原来没有这个文件时必须要带，已经存在这个文件了就不要带<code>-c</code>参数了。</p>
<p>接着安装<code>fcgiwrap</code>包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get install fcgiwrap</span></span><br></pre></td></tr></table></figure></p>
<p>修改Nginx的配置文件，增加如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 配置以 /git 开始的虚拟目录</span><br><span class="line">location ~ /git(/.*) &#123;</span><br><span class="line">        # 使用 Basic 认证</span><br><span class="line">        auth_basic &quot;Restricted&quot;;</span><br><span class="line">        # 认证的用户文件</span><br><span class="line">        auth_basic_user_file /etc/nginx/passwd;</span><br><span class="line">				</span><br><span class="line">        # FastCGI 参数</span><br><span class="line">        fastcgi_pass  unix:/var/run/fcgiwrap.socket;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME /usr/lib/git-core/git-http-backend;</span><br><span class="line">        fastcgi_param GIT_HTTP_EXPORT_ALL &quot;&quot;;</span><br><span class="line">        # git 库在服务器上的根目录</span><br><span class="line">        fastcgi_param GIT_PROJECT_ROOT    /home/git;</span><br><span class="line">        fastcgi_param PATH_INFO           $1;</span><br><span class="line">        # 将认证用户信息传递给 fastcgi 程序</span><br><span class="line">        fastcgi_param REMOTE_USER $remote_user;</span><br><span class="line">        # 包涵默认的 fastcgi 参数；</span><br><span class="line">        include       fastcgi_params;</span><br><span class="line">        # 将允许客户端 post 的最大值调整为 100 兆</span><br><span class="line">        client_max_body_size 100M;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>重启nginx后，在其他机器就可以用http协议访问远程库了，如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> http://&lt;ip or domainname&gt;/git/sample.git</span><br></pre></td></tr></table></figure></p>
<p>系统会出现对话框，提示输入用户名和密码，输入上面用<code>htpasswd</code>命令创建的用户名和密码即可。</p>
<h2 id="Git协议"><a href="#Git协议" class="headerlink" title="Git协议"></a>Git协议</h2><p>顺便介绍下Git协议，这是git专用的一个协议，访问远程库的速度最快，但Git协议缺少用户的鉴权，所以一般只用于下载，默认情况下，通过Git协议不能push代码。<br>git安装后，已经支持通过Git协议，但需要在仓库的目录下增加一个空文件<code>git-daemon-export-ok</code>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># touch /home/git/sample.git/git-daemon-export-ok</span></span><br></pre></td></tr></table></figure></p>
<p>加了这个文件，表示这个仓库支持通过Git协议访问。</p>
<p>用如下命令启动Git协议的守护进程，默认会监听在9418端口。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git daemon --reuseaddr --base-path=/home/git/ /home/git/</span></span><br></pre></td></tr></table></figure></p>
<p>然后其他机器就能通过Git协议访问这个远程库了：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git://&lt;ip or domainname&gt;/sample.git</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/14/git-create-remote-server/" itemprop="url">
                  Git自建远程仓库
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-14T10:34:23+08:00" content="2016-06-14">
              2016-06-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>用Git做代码控制时，除了放在GitHub这类公开的远程仓库，还可以很方便的自己建个远程仓库玩。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>找一台Linux机器，以Ubuntu为例，先添加一个git用户，供其他电脑访问远程库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser git</span><br></pre></td></tr></table></figure></p>
<p>如果是个人使用或小范围团队使用，通过SSH来访问会比较简单，收集所有需要访问的用户的ssh pub key，写入 <code>/home/git/.ssh/authorized_keys</code>，一行一条。</p>
<p>为了安全，也可以限制 git 用户登录 shell，编辑 <code>/etc/passwd</code>，找到以下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git:x:1001:1001:,,,:/home/git:/bin/bash</span><br></pre></td></tr></table></figure></p>
<p>把 <code>/bin/bash</code> 修改为 <code>/usr/bin/git-shell</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure></p>
<p>git-shell一登录就会立即退出。</p>
<h2 id="新建远程仓库"><a href="#新建远程仓库" class="headerlink" title="新建远程仓库"></a>新建远程仓库</h2><p>远程仓库通常只需要做版本控制，不需要在上面直接修改提交代码，因此可以创建一个裸仓库，裸仓库没有工作区。<br>找一个放仓库的目录，如 <code>/home/git</code>，在这个目录下执行以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo git init --bare sample.git</span><br></pre></td></tr></table></figure></p>
<p>sample可以根据实际修改为自己想要的名称，git远程仓库往往以<code>.git</code>为后缀，上面的命令会建立一个空的仓库，目录名为sample.git。</p>
<p>把目录的所有者改为git<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chown -R git:git sample.git</span><br></pre></td></tr></table></figure></p>
<p>至此远程仓库就建好了，在其他电脑，可以直接clone这个仓库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@&lt;remote server ip&gt;:/home/git/sample</span><br></pre></td></tr></table></figure></p>
<h2 id="一个本地库关联多个远程库"><a href="#一个本地库关联多个远程库" class="headerlink" title="一个本地库关联多个远程库"></a>一个本地库关联多个远程库</h2><p>公司正式项目的远程仓库需要做每日构建，对提交的代码有一定的要求，必须要功能完备没有编译错误才能提交，同时还限制了在远程仓库上创建分支。如果有个功能需要多人来协作开发，就可以用多个远程库的方式，在功能还未开发完时在团队内同步代码。<br>自建的远程库可以克隆自项目原来的库，如执行以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> --bare -b &lt;branch&gt; --depth 1 &lt;project url&gt; [&lt;<span class="built_in">local</span> dir&gt;]</span><br></pre></td></tr></table></figure></p>
<p>和上面新建一样，<code>--bare</code>表示这是一个没有工作区的裸仓库。<br>如果项目库有多个分支，<code>-b &lt;branch&gt;</code> 表示只克隆某个分支，不需要将全库克隆下来。<br><code>--depth 1</code> 表示是浅克隆，只克隆最新的变更记录，其他不克隆。<br><code>&lt;project url&gt;</code> 是项目远程仓库的地址，<code>&lt;local dir&gt;</code> 为本地目录，可选。</p>
<p>克隆后，同样把所有者改为git用户<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chown -R git:git &lt;<span class="built_in">local</span> dir&gt;</span><br></pre></td></tr></table></figure></p>
<p>团队成员，在自己机器的本地库上，添加新的远程库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin2 git@&lt;team server ip&gt;:/home/git/sample</span><br></pre></td></tr></table></figure></p>
<p>远程库的名称默认是origin，为了和原有的远程库区分开，这里把新增的远程库命名为origin2</p>
<p>添加后，这个本地库就关联了2个远程库，代码可以先提交到团队自己的远程库，其他人就能通过拉取这个远程仓库及时获取他人的开发内容，待功能全部完成后再一次性提交到项目正式的远程库。<br>从新建的远程库拉取和提交修改：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git pull origin2 master</span><br><span class="line">$ git push origin2 master</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/09/nginx-reverse-proxy-google/" itemprop="url">
                  利用Nginx反向代理谷歌
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-09T11:23:56+08:00" content="2016-06-09">
              2016-06-09
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>自从谷歌被墙，虽然在家可以翻墙访问，但在公司翻墙不方便，只能在网上找谷歌镜像站（镜像站是通俗叫法，更准确的叫法是反向代理）。但这些找来的镜像站往往不太稳定，经常过一段时间就不能访问甚至也会被墙，所以想着要搭个个人自用的反向代理。</p>
<h2 id="搭反向代理需要的条件"><a href="#搭反向代理需要的条件" class="headerlink" title="搭反向代理需要的条件"></a>搭反向代理需要的条件</h2><ul>
<li><p>一个墙外的VPS<br>对VPS的要求不高，搬瓦工128m内存的小机，搭建及使用均毫无压力。</p>
</li>
<li><p>一个域名<br>网上有很多地方可以申请免费的域名，比如<a href="http://www.freenom.com/" target="_blank" rel="external">Freenom</a>，可以免费申请.tk、.ml、.cf、.ga等后缀的顶级域名，最长一年免费，到期可以免费续期。</p>
</li>
<li><p>域名的SSL证书<br>其实反向代理本身是不需要SSL证书的，但如果没有证书只用http，仍然会被墙检测到搜索的内容，也就非常容易被拦截甚至被封IP，所以，反代谷歌最好有SSL证书，用https协议来访问。<br>网上能免费申请SSL证书的地方不多，推荐<a href="https://www.startssl.com/" target="_blank" rel="external">StartSSL</a>，也是最长一年免费，到期再免费续期。申请SSL证书的步骤比较麻烦，可以看看这个教程：<a href="http://www.freehao123.com/startssl-ssl-apache-ngnix/" target="_blank" rel="external">新StartSSL免费SSL证书申请使用</a>。</p>
</li>
</ul>
<h2 id="安装并编译Nginx"><a href="#安装并编译Nginx" class="headerlink" title="安装并编译Nginx"></a>安装并编译Nginx</h2><p>Nginx自身就支持反向代理功能，但为了更好的反代谷歌，还需要至少一个第三方模块，Nginx加入第三方模块相对有点麻烦，需要下载源码重新编译。<br>这次折腾编译Nginx，参考了些网上的教程，但没有完全按照教程，步骤稍有点多，主要想尽量保留原有发行版的功能，以备以后用Nginx做其他用途。</p>
<p>以下命令全是在Ubuntu上执行，CentOs的命令不一样，用户默认为root，非root用户很多命令需要加sudo。</p>
<p>先安装需要用到的一些包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get update</span></span><br><span class="line"><span class="comment"># apt-get install libpcre3 libpcre3-dev</span></span><br><span class="line"><span class="comment"># apt-get install zlib1g zlib1g-dev openssl libssl-dev</span></span><br><span class="line"><span class="comment"># apt-get install libxml2 libxml2-dev libxslt1-dev</span></span><br><span class="line"><span class="comment"># apt-get install libgd-dev libgeoip-dev</span></span><br><span class="line"><span class="comment"># apt-get install -y gcc g++ make automake</span></span><br></pre></td></tr></table></figure></p>
<p>安装Nginx的发行版<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get install nginx</span></span><br></pre></td></tr></table></figure></p>
<p>查看发行版的版本号和编译参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx -V</span></span><br><span class="line">nginx version: nginx/1.9.3 (Ubuntu)</span><br><span class="line">built with OpenSSL 1.0.2d 9 Jul 2015</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --with-cc-opt=<span class="string">'-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2'</span> --with-ld-opt=<span class="string">'-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now'</span> --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-ipv6 --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_addition_module --with-http_dav_module --with-http_geoip_module --with-http_gzip_static_module --with-http_image_filter_module --with-http_spdy_module --with-http_sub_module --with-http_xslt_module --with-mail --with-mail_ssl_module</span><br></pre></td></tr></table></figure></p>
<p>从上面的信息可以看到当前安装的是1.9.3版本，configure arguments后面跟的一长串是发行版的编译参数，很重要，后面需要用到。</p>
<p>找一个目录放源码，在这个目录里下载对应版本的Nginx源码并解压：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget http://nginx.org/download/nginx-1.9.3.tar.gz</span></span><br><span class="line"><span class="comment"># tar -zxvf nginx-1.9.3.tar.gz</span></span><br></pre></td></tr></table></figure></p>
<p>为了在反代时，更好的替换原网页中的信息，需要在编译时增加一个第三方模块：<a href="https://github.com/yaoweibin/ngx_http_substitutions_filter_module" target="_blank" rel="external">substitutions 扩展</a><br>下载 substitutions 的源码<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git clone https://github.com/yaoweibin/ngx_http_substitutions_filter_module</span></span><br></pre></td></tr></table></figure></p>
<p>下载后，会在当前目录下有个 ngx_http_substitutions_filter_module 目录</p>
<p>另一个用于便捷配置反代Google的第三方模块：<a href="https://github.com/cuber/ngx_http_google_filter_module" target="_blank" rel="external">ngx_http_google_filter_module</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/cuber/ngx_http_google_filter_module</span><br></pre></td></tr></table></figure></p>
<p>下载后，会在当前目录下有个 ngx_http_google_filter_module 目录，这个模块可选，增加后在Nginx配置文件中可以很简单的反代google</p>
<p>进入Nginx源码的目录，设置编译参数，其实就是在原发行版的编译参数后，增加两个<code>--add-module=../xxx</code>，把两个第三方模块包括进来。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd nginx-1.9.3</span></span><br><span class="line"><span class="comment"># ./configure \</span></span><br><span class="line">&gt; --with-cc-opt=<span class="string">'-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2'</span> --with-ld-opt=<span class="string">'-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now'</span> --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-ipv6 --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_addition_module --with-http_dav_module --with-http_geoip_module --with-http_gzip_static_module --with-http_image_filter_module --with-http_spdy_module --with-http_sub_module --with-http_xslt_module --with-mail --with-mail_ssl_module \</span><br><span class="line">&gt; --add-module=../ngx_http_substitutions_filter_module \</span><br><span class="line">&gt; --add-module=../ngx_http_google_filter_module</span><br></pre></td></tr></table></figure></p>
<p>设置后，会开始检查这些编译参数和环境，如果上面少安装了某些包，或更新的版本需要其他的包，就会报错，如少安装了libgeoip-dev，会报如下错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: the GeoIP module requires the GeoIP library.</span><br></pre></td></tr></table></figure></p>
<p>如果报了这类错误，可以Google一下错误信息，找到缺失的包并安装，然后再次执行 <code>./configure ...</code> 命令设置编译参数。</p>
<p>如果检查通过，最后会显示如下的信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + using system OpenSSL library</span><br><span class="line">  + md5: using OpenSSL library</span><br><span class="line">  + sha1: using OpenSSL library</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: &quot;/usr/share/nginx&quot;</span><br><span class="line">  nginx binary file: &quot;/usr/share/nginx/sbin/nginx&quot;</span><br><span class="line">  nginx configuration prefix: &quot;/etc/nginx&quot;</span><br><span class="line">  nginx configuration file: &quot;/etc/nginx/nginx.conf&quot;</span><br><span class="line">  nginx pid file: &quot;/run/nginx.pid&quot;</span><br><span class="line">  nginx error log file: &quot;/var/log/nginx/error.log&quot;</span><br><span class="line">  nginx http access log file: &quot;/var/log/nginx/access.log&quot;</span><br><span class="line">  nginx http client request body temporary files: &quot;/var/lib/nginx/body&quot;</span><br><span class="line">  nginx http proxy temporary files: &quot;/var/lib/nginx/proxy&quot;</span><br><span class="line">  nginx http fastcgi temporary files: &quot;/var/lib/nginx/fastcgi&quot;</span><br><span class="line">  nginx http uwsgi temporary files: &quot;/var/lib/nginx/uwsgi&quot;</span><br><span class="line">  nginx http scgi temporary files: &quot;/var/lib/nginx/scgi&quot;</span><br></pre></td></tr></table></figure></p>
<p>然后编译Nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># make </span></span><br><span class="line"><span class="comment"># make install</span></span><br></pre></td></tr></table></figure></p>
<p>将编译后的文件替换到发行版的安装目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cp -rf objs/nginx /usr/sbin/nginx</span></span><br></pre></td></tr></table></figure></p>
<p>可以用如下命令来关闭/启动 Nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl stop nginx</span></span><br><span class="line"><span class="comment"># systemctl start nginx</span></span><br></pre></td></tr></table></figure></p>
<p>用如下命令可以查看运行的状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl status nginx</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Nginx的设置"><a href="#Nginx的设置" class="headerlink" title="Nginx的设置"></a>Nginx的设置</h2><p>Nginx的配置文件是 <code>/etc/nginx/nginx.conf</code>，贴一下我反代Google的设置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># upstream配置google的ip，ip可以通过 nslookup www.google.com 命令获取，</span><br><span class="line"># 多运行几次nslookup会获取到多个IP，有助于避免触发google的防机器人检测。</span><br><span class="line">upstream www.google.com &#123;</span><br><span class="line">    server 172.217.0.4:443 weight=1;</span><br><span class="line">    server 172.217.1.36:443 weight=1;</span><br><span class="line">    server 216.58.193.196:443 weight=1;</span><br><span class="line">    server 216.58.216.4:443 weight=1;</span><br><span class="line">    server 216.58.216.36:443 weight=1;</span><br><span class="line">    server 216.58.219.36:443 weight=1;</span><br><span class="line">    server 74.125.25.99:443 weight=1;</span><br><span class="line">    server 74.125.25.103:443 weight=1;</span><br><span class="line">    server 74.125.25.104:443 weight=1;</span><br><span class="line">    server 74.125.25.105:443 weight=1;</span><br><span class="line">    server 74.125.25.106:443 weight=1;</span><br><span class="line">    server 74.125.25.147:443 weight=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 这里将http的访问强制跳转到https，&lt;domain.name&gt;改为自己的域名。</span><br><span class="line">server &#123; </span><br><span class="line">    listen 80;</span><br><span class="line">    server_name &lt;domain.name&gt;;</span><br><span class="line">    # http to https</span><br><span class="line">    location / &#123;</span><br><span class="line">          rewrite ^/(.*)$ https://&lt;domain.name&gt;$1 permanent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># https的设置</span><br><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  &lt;domain.name&gt;;</span><br><span class="line">    resolver 8.8.8.8;</span><br><span class="line">    </span><br><span class="line">    # SSL证书的设置，&lt;path to ssl.xxx&gt;改为自己的证书路径</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &lt;path to ssl.crt&gt;;</span><br><span class="line">    ssl_certificate_key &lt;path to ssl.key&gt;;</span><br><span class="line"></span><br><span class="line">    # 防止网络爬虫</span><br><span class="line">    #forbid spider</span><br><span class="line">    if ($http_user_agent ~* &quot;qihoobot|Baiduspider|Googlebot|Googlebot-Mobile|Googlebot-Image|Mediapartners-Google|Adsbot-Google|Feedfetcher-Google|Yahoo! Slurp|Yahoo! Slurp China|YoudaoBot|Sosospider|Sogou spider|Sogou web spider|MSNBot|ia_archiver|Tomato Bot&quot;) </span><br><span class="line">    &#123; </span><br><span class="line">        return 403; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 禁止用其他域名或直接用IP访问，只允许指定的域名</span><br><span class="line">    #forbid illegal domain</span><br><span class="line">    if ( $host != &quot;&lt;domain.name&gt;&quot; ) &#123;</span><br><span class="line">        return 403; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    access_log  off;</span><br><span class="line">    error_log   on;</span><br><span class="line">    error_log  /var/log/nginx/google-proxy-error.log;</span><br><span class="line">	</span><br><span class="line">    # 编译时加了 ngx_http_google_filter_module 模块，location的设置就非常简单</span><br><span class="line">    location / &#123;</span><br><span class="line">        google on;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果编译时没有加 ngx_http_google_filter_module 模块，location的设置可以参考如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_cookie_domain google.com &lt;domain.name&gt;; </span><br><span class="line">    proxy_pass https://www.google.com;</span><br><span class="line">    proxy_connect_timeout 60s;</span><br><span class="line">    proxy_read_timeout 5400s;</span><br><span class="line">    proxy_send_timeout 5400s;</span><br><span class="line"></span><br><span class="line">    proxy_set_header Host &quot;www.google.com&quot;;</span><br><span class="line">    proxy_set_header User-Agent $http_user_agent;</span><br><span class="line">    proxy_set_header Referer https://www.google.com;</span><br><span class="line">    proxy_set_header Accept-Encoding &quot;&quot;;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr; </span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; </span><br><span class="line">    proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">    proxy_set_header Accept-Language &quot;zh-CN&quot;;</span><br><span class="line">    proxy_set_header Cookie &quot;PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=en-US:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2W1IQ-Maw&quot;;</span><br><span class="line"></span><br><span class="line">    subs_filter https://www.google.com.hk &lt;domain.name&gt;;</span><br><span class="line">    subs_filter https://www.google.com &lt;domain.name&gt;;</span><br><span class="line">    #subs_filter_types text/css text/xml text/javascript;</span><br><span class="line"></span><br><span class="line">    sub_filter_once off; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改完配置文件后，可以用 <code>nginx -t</code> 检查配置文件是否正确：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx -t</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure></p>
<p>看到上面的显示就表明设置正确。</p>
<p>配置文件修改后需要重启Nginx：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart nginx</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/04/64-27-year/" itemprop="url">
                  二十七年了
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-04T12:13:14+08:00" content="2016-06-04">
              2016-06-04
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>从来不需要想起，永远也不会忘记！纪念那年，那些勇敢的人！</p>
<p><img src="/images/8964/tankman.jpg" alt="tankman" title="tankman"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/02/ubuntu-use-proxy/" itemprop="url">
                  Ubuntu设置使用代理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-02T14:33:03+08:00" content="2016-06-02">
              2016-06-02
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>为了方便测试一些命令和工具，在公司用VirtualBox安装了一个Ubuntu的Server版，Server版默认没有图像界面，跑起来对系统资源的占用比较少，很适合用于虚拟机，特别是在公司用了很多年的低配置电脑上。</p>
<p>在公司上网需要通过代理，这里简要介绍一下Ubuntu几个可能需要设置代理的地方。</p>
<h2 id="设置apt-conf"><a href="#设置apt-conf" class="headerlink" title="设置apt.conf"></a>设置apt.conf</h2><p>Ubuntu在安装时就会提示输入代理的设置，设置的代理保存在 /etc/apt/apt.conf 文件里，文件内容格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Acquire::http::Proxy &quot;http://&lt;proxy.server&gt;:&lt;port&gt;/&quot;;</span><br></pre></td></tr></table></figure></p>
<p>如果安装时没设置代理，或代理有变化，以后也可以编辑修改这个文件。</p>
<p>这样设置后，apt-get就可以正常使用了。</p>
<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><p>只设置apt.conf，wget或git等软件还是不能访问网络，这时可以再设置2个环境变量：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> http_proxy=http://&lt;proxy.server&gt;:&lt;port&gt;/</span><br><span class="line">$ <span class="built_in">export</span> https_proxy=http://&lt;proxy.server&gt;:&lt;port&gt;/</span><br></pre></td></tr></table></figure></p>
<p>或者将这2条命令添加到 ~/.bashrc 结尾。<br>如果访问的代理需要用户名和密码，上面的代理设置可以写成 <code>http://&lt;user&gt;:&lt;password&gt;@&lt;proxy.server&gt;:&lt;port&gt;/</code> 。<br>有了这两个环境变量，wget或git（通过http/https）等命令就可以正常访问网络了。</p>
<h2 id="wget的设置"><a href="#wget的设置" class="headerlink" title="wget的设置"></a>wget的设置</h2><p>对于wget，还可以编辑/etc/wgetrc，找到如下内容，去掉设置项前的<code>#</code>号并修改其中的内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># You can set the default proxies for Wget to use for http, https, and ftp.</span><br><span class="line"># They will override the value in the environment.</span><br><span class="line">#https_proxy = http://proxy.yoyodyne.com:18023/</span><br><span class="line">#http_proxy = http://proxy.yoyodyne.com:18023/</span><br><span class="line">#ftp_proxy = http://proxy.yoyodyne.com:18023/</span><br><span class="line"></span><br><span class="line"># If you do not want to use proxy at all, set this to off.</span><br><span class="line">#use_proxy = on</span><br></pre></td></tr></table></figure></p>
<p>或者在主目录下新建一个文件 ~/.wgetrc，将上面那段内容复制过来并按实际修改。</p>
<p>如果想临时使用一个代理，不想修改配置文件或设置环境变量，可以在wget命令中增加 <code>-e &quot;xxx&quot;</code> 选项，这个选项是执行一个wgetrc格式的命令。<br>命令格式如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget <span class="_">-e</span> <span class="string">"use_proxy=on"</span> <span class="_">-e</span> <span class="string">"http_proxy=http://&lt;proxy.server&gt;:&lt;port&gt;/"</span> &lt;url&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="Git的设置"><a href="#Git的设置" class="headerlink" title="Git的设置"></a>Git的设置</h2><p>Git支持Git、SSH、HTTP/HTTPS三种协议访问远程仓库，3钟协议的远程仓库地址格式不同，以 GitHub 为例：<br>Git协议：<code>git://github.com/...</code><br>SSH协议：<code>git@github.com:...</code><br>HTTP/HTTPS协议：<code>http://github.com/...</code> 或 <code>https://github.com/...</code></p>
<p>上面设置的环境变量，可以让Git使用HTTP/HTTPS协议通过代理访问远程仓库。</p>
<p>除了设环境变量，Git也可以通过如下命令设置http的代理：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global http.proxy http://&lt;user&gt;:&lt;password&gt;@&lt;proxy.server&gt;:&lt;port&gt;</span><br></pre></td></tr></table></figure></p>
<p>如果要通过Git协议访问远程仓库，可以先安装一个软件 connect-proxy （其他发行版可能叫 proxy-connect）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install connect-proxy</span><br></pre></td></tr></table></figure></p>
<p>然后在 /usr/bin 下新建一个文件 httpproxywrapper ，内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">connect -H &lt;proxy.server&gt;:&lt;port&gt; &quot;$@&quot;</span><br></pre></td></tr></table></figure></p>
<p>上面的 -H 表示是Http代理，如果是socks代理，需要改为 -S。</p>
<p>给 httpproxywrapper 设置可执行权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod +x /usr/bin/httpproxywrapper</span><br></pre></td></tr></table></figure></p>
<p>然后设置 git 使用代理：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.gitproxy /usr/bin/httpproxywrapper</span><br></pre></td></tr></table></figure></p>
<p>或设置环境变量：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> GIT_PROXY_COMMAND=<span class="string">"/usr/bin/httpproxywrapper"</span></span><br></pre></td></tr></table></figure></p>
<p>这样设置，就可以用Git协议通过代理访问远程仓库了。</p>
<p>至于Git的SSH协议，网上找了几种方法，但经测试均无法通过http代理访问远程仓库，猜测可能和公司的代理设置有关，就不折腾了。</p>
<h2 id="Docker的设置"><a href="#Docker的设置" class="headerlink" title="Docker的设置"></a>Docker的设置</h2><p>Docker要使用代理，需要修改 <code>etc/default/docker</code> 这个文件，在其中增加如下几行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http_proxy=http://&lt;proxy.server&gt;:&lt;port&gt;</span><br><span class="line">https_proxy=http://&lt;proxy.server&gt;:&lt;port&gt;</span><br><span class="line">export http_proxy https_proxy</span><br></pre></td></tr></table></figure></p>
<p>需要注意，原文档中有一行注释 <code>#export http_proxy=&quot;http://127.0.0.1:3128/&quot;</code>，但按照这样的格式直接写 <code>export http_proxy=http://&lt;proxy.server&gt;:&lt;port&gt;</code> 却不生效。</p>
<p>修改后，需要重启Docker才能使设置生效：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart docker</span><br></pre></td></tr></table></figure></p>
<p>用以下命令查看设置是否成功：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker info</span><br></pre></td></tr></table></figure></p>
<p>在返回信息中看到有以下两行就表明OK了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Http Proxy: http://&lt;proxy.server&gt;:&lt;port&gt;</span><br><span class="line">Https Proxy: http://&lt;proxy.server&gt;:&lt;port&gt;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/01/find-google-ip-ranges/" itemprop="url">
                  如何查找Google的IP地址段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-01T16:20:09+08:00" content="2016-06-01">
              2016-06-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一般查找域名对应的IP，可以用这个命令 <code>nslookup &lt;域名&gt;</code>，但这样找，返回的ip比较少，今天看到一条命令，可以批量查找Google当前的IP范围。</p>
<p>命令及返回的结果如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nslookup -q=TXT _netblocks.google.com 8.8.8.8</span></span><br><span class="line">Server:         8.8.8.8</span><br><span class="line">Address:        8.8.8.8<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">_netblocks.google.com   text = <span class="string">"v=spf1 ip4:64.18.0.0/20 ip4:64.233.160.0/19 ip4:66.102.0.0/20 ip4:66.249.80.0/20 ip4:72.14.192.0/18 ip4:74.125.0.0/16 ip4:108.177.8.0/21 ip4:173.194.0.0/16 ip4:207.126.144.0/20 ip4:209.85.128.0/17 ip4:216.58.192.0/19 ip4:216.239.32.0/19 ~all"</span></span><br><span class="line"></span><br><span class="line">Authoritative answers can be found from:</span><br></pre></td></tr></table></figure></p>
<p>这条命令是从谷歌的DNS服务器（8.8.8.8），获取很多的IP地址段。每个地址段格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">216.239.32.0/19</span><br></pre></td></tr></table></figure></p>
<p>这是一个CIDR（无类别域间路由，Classless Inter-Domain Routing），前面的216.239.32.0是起始地址，后面的/19表示掩码的位数，这里具体的掩码是255.255.224.0，在这个掩码范围内的都是Google的IP，总计8190个。掩码位数越小，表示IP地址段的范围越大。上面查到的这些地址段表示的IP，全部加起来大概有二十多万个。</p>
<p>要根据CIDR计算地址范围可以<a href="http://www.aboutmyip.com/AboutMyXApp/SubnetCalculator.jsp?ipAddress=216.239.32.0&amp;cidr=19" target="_blank" rel="external">点这里</a>。</p>
<p>另外，VPS上安装的精简版Ubuntu，默认并没有安装nslookup，可以执行以下命令安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get install dnsutils</span></span><br></pre></td></tr></table></figure></p>
<p>Centos安装nslookup的命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install bind-utils</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/30/google-search-skill/" itemprop="url">
                  Google常用搜索技巧
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-30T10:24:20+08:00" content="2016-05-30">
              2016-05-30
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Google是个人最常用的搜索引擎，没有之一，这里简单整理记录一下常用的一些Google搜索技巧，用好了，在搜索时能起到事半功倍的效果。</p>
<h2 id="或操作"><a href="#或操作" class="headerlink" title="或操作"></a>或操作</h2><p>一般搜索时，如果输入多个词，默认是与的关系，如输入词1和词2，即搜索同时包含词1和词2的网页，如果想搜包含词1 <strong>或</strong>包含词2 <strong>或</strong>同时都包含的网页，可以使用大写的 <code>OR</code>（不能用小写）。</p>
<p>举例：电影《肖申克的救赎》在台湾的翻译是《刺激1995》，如搜索关于这个电影的相关内容，搜索条件可以输入 <code>肖申克的救赎 OR 刺激1995</code>，可以把相关的内容一次全搜索出来。</p>
<h2 id="减号"><a href="#减号" class="headerlink" title="减号"></a>减号</h2><p>在搜索时，如果想排除某些内容，可以使英文字符 <code>-</code> 号。</p>
<p>举例：如搜索佛教中关于天龙八部的信息，想要排除金庸那本著名的同名小说，搜索条件可以输入 <code>天龙八部 佛教 -金庸</code>。</p>
<h2 id="星号或问号"><a href="#星号或问号" class="headerlink" title="星号或问号"></a>星号或问号</h2><p>有时记不清某个词或句子中的部分内容，或想模糊查询，可以在查询时使用通配符 <code>*</code> 或 <code>?</code>。</p>
<p>举例：如搜索<code>反向*理</code>，可以匹配“反向代理”、“反向D理”、“反向代-理”等内容</p>
<h2 id="双引号"><a href="#双引号" class="headerlink" title="双引号"></a>双引号</h2><p>正常搜索时，Google会试图找出含有全部搜索内容的网页，但对内容的次序并不关心，如果想要精确定位，可以将内容用双引号括起来。</p>
<p>举例：如搜索<code>&quot;postgresql教程&quot;</code>，得到的结果会明显少于<code>postgresql教程</code>。</p>
<h2 id="site"><a href="#site" class="headerlink" title="site"></a>site</h2><p>想让搜索限定在某个网站内，可以使用<code>site:xxxxx</code></p>
<p>举例：如只想在v2ex里搜索FinalSpeed相关的内容，搜索条件可以输入 <code>finalspeed site:v2ex.com</code><br>注意：site后的冒号是英文字符，且冒号后不能跟空格。网址中不需要有www、http、/等字符。</p>
<h2 id="filetype"><a href="#filetype" class="headerlink" title="filetype"></a>filetype</h2><p>如果要找一些文档资料，想指定某个文档类型，可以用<code>filetype:xxx</code>，而且Google支持直接搜索PDF、DOC等文件。</p>
<p>举例：如搜索关于PostgreSQL的相关PDF资料，搜索条件可以输入 <code>postgresql filetype:pdf</code></p>
<h2 id="intitle-和-allintitle"><a href="#intitle-和-allintitle" class="headerlink" title="intitle 和 allintitle"></a>intitle 和 allintitle</h2><p>有时只想要在网页的标题中搜索某些内容，可以用intitle 或 allintitle</p>
<p>举例：如在标题中搜索“postgresql 教程”，可以用以下用法：<code>intitle:postgresql 教程</code>，或<code>allintitle:postgresql 教程</code>，后一种写法等同于<code>intitle:postgresql intitle:教程</code></p>
<h2 id="intext-和-allintext"><a href="#intext-和-allintext" class="headerlink" title="intext 和 allintext"></a>intext 和 allintext</h2><p>这两个是在正文中搜索，用法类似intitle 和 allintitle。</p>
<h2 id="inurl-和-allinurl"><a href="#inurl-和-allinurl" class="headerlink" title="inurl 和 allinurl"></a>inurl 和 allinurl</h2><p>这两条命令是在网页地址中搜索，用法类似intitle 和 allintitle。</p>
<p>最后说一句：珍爱生命，远离百度。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="匿名" />
          <p class="site-author-name" itemprop="name">匿名</p>
          <p class="site-description motion-element" itemprop="description">没有什么能够阻挡，你对自由的向往！</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">21</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">匿名</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  

  

  

</body>
</html>
